Ext.namespace("GeoNetwork");var catalogue;var app;GeoNetwork.app=function(){var f;var q=false;var w;var F;var C={};var K;var n;var E;var d;var J;var s;var D;var b,A;var j,v,L;var u=false;function t(){var M={xtype:"radiogroup",id:"ms",hidden:!GeoNetwork.MapModule,items:[{name:"mode",ctCls:"mn-main",boxLabel:OpenLayers.i18n("discovery"),id:"discoveryMode",width:110,inputValue:0,checked:true},{name:"mode",ctCls:"mn-main",width:140,boxLabel:OpenLayers.i18n("visualization"),id:"visualizationMode",inputValue:1}],listeners:{change:function(N,O){app.switchMode(O.getGroupValue(),false)}}};return new Ext.form.FormPanel({renderTo:"mode-form",border:false,layout:"hbox",items:M})}function e(){n=new GeoNetwork.mapApp();n.init(GeoNetwork.map.BACKGROUND_LAYERS,GeoNetwork.map.MAIN_MAP_OPTIONS);D.addMap(n.getMap());u=true;var N=Ext.getCmp("toctree");Ext.getCmp("organizeTab").add(N);Ext.getCmp("printPanelTab").add(Ext.getCmp("printPanel"));var M=Ext.getCmp("mapViewportEastPanel");n.getViewport().remove(M)}function x(M){return new Ext.form.FormPanel({renderTo:"lang-form",width:80,border:false,layout:"hbox",hidden:GeoNetwork.Util.locales.length===1?true:false,items:[new Ext.form.ComboBox({mode:"local",triggerAction:"all",width:80,store:new Ext.data.ArrayStore({idIndex:0,fields:["id","name"],data:GeoNetwork.Util.locales}),valueField:"id",displayField:"name",value:M,listeners:{select:function(O,P,N){window.location.replace("?hl="+O.getValue())}}})]})}function k(){var M=new GeoNetwork.LoginForm({renderTo:"login-form",catalogue:K});K.on("afterBadLogin",i,this)}function i(M,N){Ext.Msg.show({title:"Login",msg:"Login failed. Check your username and password.",icon:Ext.MessageBox.ERROR,buttons:Ext.MessageBox.OK})}function r(){var Q=[];var Y=K.services;var W=new GeoNetwork.form.OpenSearchSuggestionTextField({hideLabel:false,minChars:1,hideTrigger:false,url:Y.opensearchSuggest,field:"orgName",name:"E_orgName",fieldLabel:OpenLayers.i18n("org")});var Z=new GeoNetwork.form.OpenSearchSuggestionTextField({hideLabel:false,minChars:1,hideTrigger:false,url:Y.opensearchSuggest,field:"keyword",name:"E_themekey",fieldLabel:OpenLayers.i18n("keyword")});var U=new Ext.form.FieldSet({title:OpenLayers.i18n("when"),autoWidth:true,defaultType:"datefield",collapsible:true,collapsed:true,items:GeoNetwork.util.SearchFormTools.getWhen()});var T=GeoNetwork.util.SearchFormTools.getCatalogueField(Y.getSources,Y.logoUrl);var N=GeoNetwork.util.SearchFormTools.getGroupField(Y.getGroups);var aa=GeoNetwork.util.SearchFormTools.getMetadataTypeField();var M=GeoNetwork.util.SearchFormTools.getCategoryField(Y.getCategories,"../images/default/category/");var O=GeoNetwork.util.SearchFormTools.getValidField();var V=GeoNetwork.util.SearchFormTools.getSpatialRepresentationTypeField();var S=GeoNetwork.util.SearchFormTools.getScaleDenominatorField(true);Q.push(Z,W,M,U,V,S,T,N,aa,O);var P={xtype:"fieldset",title:OpenLayers.i18n("advancedSearchOptions"),autoHeight:true,autoWidth:true,collapsible:true,collapsed:(C.advanced?false:true),defaultType:"checkbox",defaults:{width:160},items:Q};var X=[];X.push(GeoNetwork.util.SearchFormTools.getSimpleFormFields(K.services,GeoNetwork.map.BACKGROUND_LAYERS,GeoNetwork.map.MAP_OPTIONS,true,GeoNetwork.searchDefault.activeMapControlExtent),P);var R=[N,aa,O];Ext.each(R,function(ab){ab.setVisible(false)});K.on("afterLogin",function(){Ext.each(R,function(ab){ab.setVisible(true)})});K.on("afterLogout",function(){Ext.each(R,function(ab){ab.setVisible(false)})});return new Ext.FormPanel({id:"searchForm",border:false,padding:5,defaults:{width:180},listeners:{afterrender:function(){}},items:X,buttons:[{tooltip:OpenLayers.i18n("resetSearchForm"),id:"resetBt",icon:"../images/default/cross.png",listeners:{click:function(){Ext.getCmp("searchForm").getForm().reset()}}},{text:OpenLayers.i18n("search"),id:"searchBt",icon:"../js/GeoNetwork/resources/images/default/find.png",iconAlign:"right",listeners:{click:function(){if(Ext.getCmp("geometryMap")){D.addMap(Ext.getCmp("geometryMap").map,true)}var ab=Ext.get("E_any");if(ab){if(ab.getValue()===OpenLayers.i18n("fullTextSearch")){ab.setValue("")}}K.startRecord=1;H()}}}]})}function H(){q=true;K.search("searchForm",app.loadResults,null,K.startRecord,true);var O=Ext.getCmp("infoPanel"),M=Ext.getCmp("resultsPanel"),N=Ext.getCmp("tagCloudPanel");if(O.isVisible()){O.hide()}if(!M.isVisible()){M.show()}if(!N.isVisible()){N.show()}if(GeoNetwork.MapModule&&!u){e()}}function a(){var N=new Ext.Action({id:"previousBt",text:"&lt;&lt;",handler:function(){K.startRecord-=parseInt(Ext.getCmp("E_hitsperpage").getValue(),10);H()},scope:this});var M=new Ext.Action({id:"nextBt",text:"&gt;&gt;",handler:function(){K.startRecord+=parseInt(Ext.getCmp("E_hitsperpage").getValue(),10);H()},scope:this});return new Ext.Toolbar({items:[N,"|",M,"|",{xtype:"tbtext",text:"",id:"info"}]})}function h(){D=new GeoNetwork.MetadataResultsView({catalogue:K,autoScroll:true,tpl:GeoNetwork.Templates.FULL});K.resultsView=D;b=new GeoNetwork.MetadataResultsToolbar({catalogue:K,searchBtCmp:Ext.getCmp("searchBt"),sortByCmp:Ext.getCmp("E_sortBy"),metadataResultsView:D});A=a();resultPanel=new Ext.Panel({id:"resultsPanel",border:false,hidden:true,bodyCssClass:"md-view",autoWidth:true,layout:"fit",tbar:b,items:D,bbar:A});return resultPanel}function y(O,P,M,N){if(P){p()}else{Ext.get("infoPanel").getUpdater().update({url:"home_en.html"});Ext.get("helpPanel").getUpdater().update({url:"help_en.html"})}}function z(){return new Ext.Panel({border:true,id:"infoPanel",baseCls:"md-info",autoWidth:true,contentEl:"infoContent",autoLoad:{url:"home_"+K.LANG+".html",callback:y,scope:this,loadScripts:false}})}function c(){return new Ext.Panel({border:false,frame:false,baseCls:"none",id:"helpPanel",autoWidth:true,renderTo:"shortcut",autoLoad:{url:"help_"+K.LANG+".html",callback:initShortcut,scope:this,loadScripts:false}})}function p(){var M=new GeoNetwork.TagCloudView({catalogue:K,query:"fast=true&summaryOnly=true",renderTo:"tag",onSuccess:"app.loadResults"});return M}function G(){var M=new GeoNetwork.TagCloudView({catalogue:K});return new Ext.Panel({id:"tagCloudPanel",border:true,hidden:true,baseCls:"md-view",items:M})}function o(P,M,N,O){if(!this.editorWindow){this.editorPanel=new GeoNetwork.editor.EditorPanel({defaultViewMode:GeoNetwork.Settings.editor.defaultViewMode,catalogue:K,xlinkOptions:{CONTACT:true}});this.editorWindow=new Ext.Window({tools:[{id:"newwindow",qtip:OpenLayers.i18n("newWindow"),handler:function(T,S,R,Q){window.open(GeoNetwork.Util.getBaseUrl(location.href)+"#edit="+P);R.hide()},scope:this}],title:OpenLayers.i18n("mdEditor"),id:"editorWindow",layout:"fit",modal:false,items:this.editorPanel,closeAction:"hide",collapsible:true,collapsed:false,maximizable:true,maximized:true,resizable:true,width:980,height:800});this.editorPanel.setContainer(this.editorWindow);this.editorPanel.on("editorClosed",function(){Ext.getCmp("searchBt").fireEvent("click")})}if(P){this.editorWindow.show();this.editorPanel.init(P,M,N,O)}}function l(){var M=K.getInfo();Ext.getDom("title").innerHTML='<img class="catLogo" src="../../images/logos/'+M.siteId+'.gif"/>&nbsp;'+M.name}function m(){var Q=new Ext.menu.Menu({id:"fileMenu",items:[{text:"Réinitialiser tout"},{text:"Enregistrer la session"},{text:"Restaurer la session"},"-",{text:"Ajouter une couche de données"},{text:"Chercher des données"}]});var P=new Ext.menu.Menu({id:"viewMenu",items:[{text:"Panneau latéral",menu:{items:['<b class="menu-title">Choisissez le panneau actif</b>',{text:"Choisir les couches de données",checked:true,group:"sidepanelmode",checkHandler:g},{text:"Organiser les couches de données",checked:false,group:"sidepanelmode",checkHandler:g},{text:"Chercher des données",checked:false,group:"sidepanelmode",checkHandler:g},{text:"Imprimer",checked:false,group:"sidepanelmode",checkHandler:g}]}},{text:"Barre d'outils",checked:true},{text:'Mode "dual Map"',checked:false}]});var N=new Ext.menu.Menu({id:"toolsMenu",items:[{text:"Analyse NDVI"},{text:"Analyse historique météorologique"},{text:"Moyenne d'une zone"}]});var O=new Ext.menu.Menu({id:"helpMenu",items:[{text:"Sommaire"},{text:"Raccourcis clavier"},"-",{text:"A propos"}]});var M=new Ext.Toolbar();M.add({text:"Fichiers",iconCls:"save",menu:Q},{text:"Affichage",iconCls:"view",menu:P},{text:"Outils",iconCls:"tools",menu:N},{text:"Aide",iconCls:"help",menu:O});return M}function g(N,M){}function B(Q){var R=new Array();for(var M=0;M<Q.length;M++){if(Q[M].children!=null){var P=B(Q[M].children);for(var O=0;O<P.length;O++){R.push(P[O])}}else{var S=Q[M];var N;if(S.type==null){continue}if(S.type!="wms"){OpenLayers.Console.log("omitting invalid (non-wms) layer : "+S.layers+", "+S.type)}else{N=new OpenLayers.Layer.WMS(S.layer,S.url,{layers:S.layers,format:S.format,TRANSPARENT:(S.format=="image/png")},{isBaseLayer:false,transitionEffect:"resize",buffer:0,visibility:false});R.push(N)}}}return R}function I(P,M){var O=B(M);for(var N=0;N<O.length;N++){P.addLayer(O[N])}}return{init:function(){f=GeoNetwork.URL||window.location.href.match(/(http.*\/.*)\/jpapps\/search.*/,"")[1];C=GeoNetwork.Util.getParameters(location.href);var T=GeoNetwork.Util.getCatalogueLang(C.hl||GeoNetwork.defaultLocale);if(C.extent){C.bounds=new OpenLayers.Bounds(C.extent[0],C.extent[1],C.extent[2],C.extent[3])}K=new GeoNetwork.Catalogue({statusBarId:"info",lang:T,hostUrl:f,mdOverlayedCmpId:"resultsPanel",adminAppUrl:f+"/srv/"+T+"/admin",metadataStore:GeoNetwork.Settings.mdStore,metadataCSWStore:GeoNetwork.data.MetadataCSWResultsStore(),summaryStore:GeoNetwork.data.MetadataSummaryStore(),editMode:2,metadataEditFn:o});l();K.setServiceUrl("xmlSearch",GeoNetwork.Settings.searchService);J=r();E=m();x(T);k();o();s=h();L=z();helpPanel=c();v=G();var S=Ext.extend(GeoExt.tree.LayerNodeUI,new GeoExt.tree.TreeNodeUIEventMixin());var P=new OpenLayers.Format.JSON().write(treeConfig);var R=new Ext.tree.TreePanel({title:"layerTree",id:"ilwactoctree",enableDD:false,autoScroll:true,loader:new Ext.tree.TreeLoader({applyLoader:false,uiProviders:{layernodeui:S}}),plugins:[new GeoExt.plugins.FoldableLegendPlugin({})],root:{nodeType:"async",children:Ext.decode(P)},rootVisible:false,lines:false,border:false,region:"center"});d=new Ext.TabPanel({activeTab:2,height:"100%",defaults:{},items:[{title:"Choisir",id:"choisirTab",items:[R]},{title:"Organiser",id:"organizeTab",autoScroll:true,items:[]},{title:"Chercher",autoWidth:true,height:"100%",layout:"accordion",layoutConfig:{animate:true},items:[{title:"Formulaire",id:"searchFormPanel",autoWidth:true,autoScroll:true,items:[J,v,L]},{title:"Resultats",id:"searchResultsPanel",autoWidth:true,items:[s]}]},{title:"Imprimer",id:"printPanelTab",items:[]}]});var Q="35 0 0 0";var M=new Ext.Viewport({layout:"border",id:"vp",items:[{region:"north",id:"north",margins:Q,tbar:E},{region:"west",id:"west",title:"Données",split:true,minWidth:300,width:330,maxWidth:1100,layout:"fit",collapsible:true,forceLayout:true,layoutConfig:{animate:true},items:[d]},{region:"center",id:"center",layout:"fit",minWidth:300,split:true,}]});if(C.mode){app.switchMode(C.mode,false)}GeoNetwork.util.SearchTools.populateFormFromParams(J,C);if(C.search!==undefined){Ext.getCmp("searchBt").fireEvent("click")}if(C.edit!==undefined&&C.edit!==""){K.metadataEdit(C.edit)}if(C.create!==undefined){resultPanel.getTopToolbar().createMetadataAction.fireEvent("click")}if(C.uuid!==undefined){K.metadataShow(C.uuid,true)}else{if(C.id!==undefined){K.metadataShowById(C.id,true)}}Ext.get("E_any").setWidth(285);Ext.get("E_any").setHeight(28);if(GeoNetwork.searchDefault.activeMapControlExtent){Ext.getCmp("geometryMap").setExtent()}if(C.bounds){Ext.getCmp("geometryMap").map.zoomToExtent(C.bounds)}resultPanel.setHeight(Ext.getCmp("center").getHeight());var O=["afterDelete","afterRating","afterLogout","afterLogin"];Ext.each(O,function(U){K.on(U,function(){if(q===true){Ext.getCmp("searchBt").fireEvent("click")}})});e();var N=n.getViewport();I(n.getMap(),treeConfig);Ext.getCmp("center").add(N)},getIMap:function(){if(!n){e()}return n},getCatalogue:function(){return K},loadResults:function(M){Ext.getCmp("previousBt").setDisabled(K.startRecord===1);Ext.getCmp("nextBt").setDisabled(K.startRecord+parseInt(Ext.getCmp("E_hitsperpage").getValue(),10)>K.metadataStore.totalLength);if(Ext.getCmp("E_sortBy").getValue()){Ext.getCmp("sortByToolBar").setValue(Ext.getCmp("E_sortBy").getValue()+"#"+Ext.getCmp("sortOrder").getValue())}else{Ext.getCmp("sortByToolBar").setValue(Ext.getCmp("E_sortBy").getValue())}Ext.getCmp("searchFormPanel").collapse(true);Ext.getCmp("searchResultsPanel").expand(true);Ext.getCmp("west").syncSize();Ext.getCmp("center").syncSize();Ext.ux.Lightbox.register("a[rel^=lightbox]");s.syncSize();s.setHeight(Ext.getCmp("searchFormPanel").getHeight()-20);console.log(n.getPrintPanel())},switchMode:function(R,P){var N=Ext.getCmp("ms"),Q=Ext.getCmp("east"),S=Ext.getCmp("center"),M=Ext.getCmp("west"),O;if(R===null){O=N.getValue().getGroupValue();if(O==="0"){N.onSetValue(Ext.getCmp("visualizationMode"),true)}else{N.onSetValue(Ext.getCmp("discoveryMode"),true)}R=O=N.getValue().getGroupValue()}if(P){if(R==="1"){N.onSetValue(Ext.getCmp("visualizationMode"),true)}else{N.onSetValue(Ext.getCmp("discoveryMode"),true)}}if(R==="1"&&!u){e()}if(R==="1"&&n){if(Q.collapsed){Q.toggleCollapse()}if(!M.collapsed){M.toggleCollapse()}Ext.getCmp("vp").syncSize()}else{if(!Q.collapsed){Q.toggleCollapse()}if(M.collapsed){M.toggleCollapse()}}e();S.add(n.getViewport());S.doLayout()}}};Ext.onReady(function(){var a=/hl=([a-z]{2})/.exec(location.href);GeoNetwork.Util.setLang(a&&a[1],"..");Ext.QuickTips.init();setTimeout(function(){Ext.get("loading").remove();Ext.get("loading-mask").fadeOut({remove:true})},250);app=new GeoNetwork.app();app.init();catalogue=app.getCatalogue();Ext.getCmp("center").doLayout();Ext.getDom("E_any").focus(true)});GeoNetwork.Settings={};OpenLayers.ProxyHostURL="../../proxy?url=";OpenLayers.ProxyHost=function(a){if(a&&a.indexOf(window.location.host)!=-1){return a}else{return OpenLayers.ProxyHostURL+encodeURIComponent(a)}};GeoNetwork.Util.defaultLocale="en";GeoNetwork.searchDefault={activeMapControlExtent:false};GeoNetwork.advancedFormButton=true;GeoNetwork.Settings.editor={defaultViewMode:"simple"};GeoNetwork.Settings.mdStore=GeoNetwork.data.MetadataResultsStore();GeoNetwork.Settings.searchService="xml.search";GeoNetwork.MapModule=true;GeoNetwork.ProjectionList=[["EPSG:4326","WGS84 (lat/lon)"]];GeoNetwork.WMSList=[["Geoserver","http://localhost/geoserver/wms?"]];GeoNetwork.defaultViewMode="view-simple";Ext.BLANK_IMAGE_URL="../js/ext/resources/images/default/s.gif";function initShortcut(){var b=[{key:"s",ctrl:true,shift:true,stopEvent:true,label:OpenLayers.i18n("runSearch"),fn:function(){Ext.getCmp("searchBt").fireEvent("click")}},{key:"f",ctrl:true,shift:true,stopEvent:true,label:OpenLayers.i18n("focusOnAny"),fn:function(){Ext.getCmp("E_any").focus(true)}},{key:"d",ctrl:true,shift:true,stopEvent:true,label:OpenLayers.i18n("hideSearchForm"),fn:function(){var c=Ext.getCmp("west");c.toggleCollapse()}},{key:"v",ctrl:true,shift:true,stopEvent:true,label:OpenLayers.i18n("switchMode"),fn:function(){app.switchMode(null,true)}},{key:"r",ctrl:true,shift:true,label:OpenLayers.i18n("resetSearchForm"),fn:function(){Ext.getCmp("resetBt").fireEvent("click")}},{key:"l",ctrl:true,shift:true,stopEvent:true,label:OpenLayers.i18n("focusOnLogin"),fn:function(){Ext.getCmp("username").focus(true)}},{key:"i",ctrl:true,shift:true,stopEvent:true,label:OpenLayers.i18n("displayInfoPanel"),fn:function(){var i=Ext.getCmp("infoPanel");var c=Ext.getCmp("resultsPanel");if(c.isVisible()){c.hide()}if(!i.isVisible()){i.show()}}},{key:"h",ctrl:true,shift:true,stopEvent:true,label:OpenLayers.i18n("displayHelpPanel"),fn:function(){var c=Ext.getDom("shortcut").style;if(c.display=="block"){Ext.getDom("shortcut").style.display="none"}else{Ext.getDom("shortcut").style.display="block"}}}];var g=new Ext.KeyMap(document,b);g.enable();var d="";for(var f=0;f<b.length;f++){var h=b[f];d+="<tr><td>"+(h.ctrl===true?'<span class="label">&lt;Ctrl&gt;</span> + ':"")+(h.shift===true?'<span class="label">&lt;Shift&gt;</span> + ':"")+'<span class="label">'+h.key+"</span>:</td><td>"+h.label+"</td></tr>"}var e="<table><tbody><tr><td>"+d+"</td></tr></tbody></table>";Ext.DomHelper.insertHtml("afterEnd",Ext.getDom("shortcutHelp"),e);var a=new Ext.KeyMap("searchForm",[{key:[10,13],fn:function(){Ext.getCmp("searchBt").fireEvent("click")}}]);a.enable()}Ext.namespace("GeoNetwork");GeoNetwork.Templates=Ext.extend(Ext.XTemplate,{compiled:false,disableFormats:false,catalogue:null,sortOrder:0,abstractMaxSize:50,xmlTplMarkup:['<?xml version="1.0" encoding="UTF-8"?>','<node id="{id}" type="{type}">',"<site>","<name>{site_name}</name>",'<tpl if="values.site_ogctype">',"<ogctype>{site_ogctype}</ogctype>","</tpl>",'<tpl if="values.site_url">',"<url>{site_url}</url>","</tpl>",'<tpl if="values.site_icon">',"<icon>{site_icon}</icon>","</tpl>",'<tpl if="values.site_account_use">',"<account>","<use>{site_account_use}</use>","<username>{site_account_username}</username>","<password>{site_account_password}</password>","</account>","</tpl>","</site>","<options>",'<tpl if="values.options_every">',"<every>{options_every}</every>","</tpl>",'<tpl if="values.options_onerunonly">',"<oneRunOnly>{options_onerunonly}</oneRunOnly>","</tpl>",'<tpl if="values.options_lang">',"<lang>{options_lang}</lang>","</tpl>",'<tpl if="values.options_topic">',"<topic>{options_topic}</topic>","</tpl>",'<tpl if="values.options_createthumbnails">',"<createThumbnails>{options_createthumbnails}</createThumbnails>","</tpl>",'<tpl if="values.options_uselayer">',"<useLayer>{options_uselayer}</useLayer>","</tpl>",'<tpl if="values.options_uselayermd">',"<useLayerMd>{options_uselayermd}</useLayerMd>","</tpl>",'<tpl if="values.options_datasetcategory">',"<datasetcategory>{options_datasetcategory}</datasetcategory>","</tpl>","</options>","<content>","</content>","<privileges>","</privileges>",'<group id="1">','<operation name="view" />','<operation name="dynamic" />',"</group>","<categories>","</categories>",'<tpl if="values.info_result_total">',"</tpl>","</node>"],initComponent:function(){GeoNetwork.Templates.superclass.initComponent.call(this)},getHarvesterTemplate:function(){return new Ext.XTemplate(this.xmlTplMarkup)}});GeoNetwork.Templates.TITLE='<h1><input type="checkbox" <tpl if="selected==\'true\'">checked="true"</tpl> class="selector" onclick="javascript:catalogue.metadataSelect((this.checked?\'add\':\'remove\'), [\'{uuid}\']);"/><a href="#" onclick="javascript:catalogue.metadataShow(\'{uuid}\');">{title}</a><span class="md-action-menu"> - <a rel="mdMenu">'+OpenLayers.i18n("mdMenu")+"</a></span></h1>";GeoNetwork.Templates.RATING_TPL='<tpl if="isharvested==\'n\' || harvestertype==\'geonetwork\'"><div class="rating"><input type="radio" name="rating{[xindex]}" <tpl if="rating==\'1\'">checked="true"</tpl> value="1"/><input type="radio" name="rating{[xindex]}" <tpl if="rating==\'2\'">checked="true"</tpl> value="2"/><input type="radio" name="rating{[xindex]}" <tpl if="rating==\'3\'">checked="true"</tpl> value="3"/><input type="radio" name="rating{[xindex]}" <tpl if="rating==\'4\'">checked="true"</tpl> value="4"/><input type="radio" name="rating{[xindex]}" <tpl if="rating==\'5\'">checked="true"</tpl> value="5"/></div></tpl>';GeoNetwork.Templates.LOGO='<div class="md-logo"><img src="{[catalogue.URL]}/images/logos/{source}.gif"/></div>';GeoNetwork.Templates.SIMPLE=new Ext.XTemplate("<ul>",'<tpl for=".">','<li class="md md-simple" title="{abstract}">','<table><tr><td style="width:30px;">',GeoNetwork.Templates.LOGO,'</td><td id="{uuid}">',GeoNetwork.Templates.TITLE,'<span class="subject"><tpl for="subject">','{value}{[xindex==xcount?"":", "]}',"</tpl></span>","</td></tr></table>","</li>","</tpl>","</ul>");GeoNetwork.Templates.THUMBNAIL=new Ext.XTemplate("<ul>",'<tpl for=".">','<li class="md md-thumbnail">','<div class="md-wrap" id="{uuid}" title="{abstract}">',GeoNetwork.Templates.TITLE,'<div class="thumbnail">','<tpl if="thumbnail">','<a rel="lightbox" href="{thumbnail}"><img src="{thumbnail}" alt="Thumbnail"/></a>',"</tpl>","<tpl if=\"thumbnail==''\"></tpl>","</div>",'<tpl for="links">',"<tpl if=\"values.type == 'application/vnd.ogc.wms_xml'\">","<a href=\"#\" class=\"md-mn addLayer\" title=\"{title}\" alt=\"{title}\" onclick=\"app.switchMode('1', true);app.getIMap().addWMSLayer([['{title}', '{href}', '{name}', '{id}']]);\">&nbsp;</a>","</tpl>","</tpl>","</div>","</li>","</tpl>","</ul>");GeoNetwork.Templates.FULL=new Ext.XTemplate("<ul>",'<tpl for=".">','<li class="md md-full">',"<table><tr>",'<td class="left">',GeoNetwork.Templates.LOGO,"</td>",'<td id="{uuid}">','<div class="thumb">',GeoNetwork.Templates.RATING_TPL,'<div class="thumbnail">','<tpl if="thumbnail">','<a rel="lightbox" href="{thumbnail}"><img src="{thumbnail}" alt="Thumbnail"/></a>',"</tpl>","<tpl if=\"thumbnail==''\"></tpl>","</div>","</div>",GeoNetwork.Templates.TITLE,'<p class="abstract">{[values.abstract.substring(0, 350)]} ...</p>','<p class="subject"><tpl for="subject">','{value}{[xindex==xcount?"":", "]}',"</tpl></p>",'<div class="md-links">','<tpl for="links">',"<tpl if=\"values.type == 'application/vnd.ogc.wms_xml' || values.type == 'OGC:WMS'\">",'<a href="#" class="md-mn addLayer" title="'+OpenLayers.i18n("addToMap")+" {title}\" alt=\"Add layer to map\" onclick=\"app.switchMode('1', true);app.getIMap().addWMSLayer([['{[escape(values.title)]}', '{href}', '{name}', '{id}']]);\">&nbsp;</a>","</tpl>","<tpl if=\"values.type == 'application/vnd.google-earth.kml+xml'\">",'<a href="{href}" class="md-mn md-mn-kml" title="'+OpenLayers.i18n("viewKml")+' {title}" alt="Open kml">&nbsp;</a>',"</tpl>","<tpl if=\"values.type == 'application/zip' || values.type == 'application/x-compressed'\">",'<a href="{href}" class="md-mn md-mn-zip" title="'+OpenLayers.i18n("downloadLink")+' {title}" alt="Download">&nbsp;</a>',"</tpl>","<tpl if=\"values.type == 'text/html'\">",'<a href="{href}" class="md-mn md-mn-www" title="'+OpenLayers.i18n("webLink")+' {title}" alt="Web link" target="_blank">&nbsp;</a>',"</tpl>","</tpl>",'<tpl if="this.hasDownloadLinks(values.links)">','<a href="#" onclick="catalogue.metadataPrepareDownload({id});" class="md-mn downloadAllIcon" title="'+OpenLayers.i18n("prepareDownload")+'" alt="download">&nbsp;</a>',"</tpl>",'</div><td class="icon">','<div class="md-mn valid-{valid}" title="'+OpenLayers.i18n("validityInfo"),'<tpl for="valid_details">',"{values.type}: ","<tpl if=\"values.valid == '1'\">"+OpenLayers.i18n("valid")+"</tpl>","<tpl if=\"values.valid == '0'\">"+OpenLayers.i18n("notValid")+"</tpl>","<tpl if=\"values.valid == '-1'\">"+OpenLayers.i18n("notDetermined")+"</tpl>","<tpl if=\"values.ratio != ''\"> ({values.ratio}) </tpl> - ","</tpl>",'">&nbsp;</div>','</td><td class="icon" title="'+OpenLayers.i18n("metadataCategories")+'">','<tpl for="category">','<div class="md-mn cat-{value}" title="{value}">&nbsp;</div>',"</tpl>","</td></tr></table>",'<div class="md-contact">','<tpl for="contact">',"<tpl if=\"applies=='resource'\">",'<span title="{role} - {applies}"><tpl if="values.logo !== undefined ">','<img src="{logo}" class="orgLogo"/>',"</tpl>","{name}</span>","</tpl>","</tpl>","<tpl if=\"edit=='true' && isharvested!='y'\">",'<br/><span class="md-mn md-mn-user" title="'+OpenLayers.i18n("ownerName")+'">{ownername} ('+OpenLayers.i18n("lastUpdate")+"{[values.changedate.split('T')[0]]})</span>","</tpl>","</div>","</li>","</tpl>","</ul>",{hasDownloadLinks:function(a){var b;for(b=0;b<a.length;b++){if(a[b].type==="application/x-compressed"){return true}}return false}});Ext.namespace("GeoNetwork");var mapInit=false;var activeIndex=0;GeoNetwork.mapApp=function(){var k,u,v,I;var s,O,o,h,P,N,A;var j;var q;var z;var w;var C;var y;var J;var B=function(R){z=R};var r=function(S,T){var R=S||{projection:"EPSG:4326",units:"degrees",maxExtent:new OpenLayers.Bounds(-180,-90,180,90),restrictedExtent:new OpenLayers.Bounds(-180,-90,180,90),controls:[]};z=new OpenLayers.Map("ol_map",R);w=T};var i=function(T,S,U,R){z.addLayer(new OpenLayers.Layer.WMS(T,S,U,R))};var L=function(R){z.addLayer(R)};var K=function(){var R=new OpenLayers.Layer.Image("Dummy","../../../js/OpenLayers/img/blank.gif",new OpenLayers.Bounds(0,300000,300000,625000),z.getSize(),{isBaseLayer:true,displayInLayerSwitcher:false});z.addLayer(R)};var f=function(){z.addControl(new GeoNetwork.Control.ZoomWheel());z.addControl(new OpenLayers.Control.LoadingPanel())};var Q=function(S){if(S){var R;R=S.attributes.layer;if(R){if(!R.isBaseLayer){if((typeof(R.isLoading)=="undefined")||(R.isLoading==false)){z.removeLayer(R);if(q==S){q=null}p(q);Ext.getCmp("toctree").getSelectionModel().clearSelections()}}}}};var E=function(){var R=Ext.getCmp("toctree").getSelectionModel().getSelectedNode();Q(R)};var x=function(S){if(S){var R;R=S.attributes.layer;if(R&&R.dimensions&&R.dimensions.time){GeoNetwork.WindowManager.showWindow("wmstime");GeoNetwork.WindowManager.getWindow("wmstime").setLayer(R)}}};var t=function(){var R=Ext.getCmp("toctree").getSelectionModel().getSelectedNode();x(R)};var l=function(S){if(S){var R;R=S.attributes.layer;if((R)&&(R.styles)&&(R.styles.length>1)){GeoNetwork.WindowManager.showWindow("layerstyles");GeoNetwork.WindowManager.getWindow("layerstyles").showLayerStyles(R)}}};var D=function(){var R=Ext.getCmp("toctree").getSelectionModel().getSelectedNode();l(R)};var n=function(S){if(S){var R;R=S.attributes.layer;if(R){GeoNetwork.WindowManager.showWindow("wmsinfo");GeoNetwork.WindowManager.getWindow("wmsinfo").showLayerInfo(R)}}};var c=function(){var R=Ext.getCmp("toctree").getSelectionModel().getSelectedNode();n(R)};var p=function(R){if((R)&&(R.attributes.layer)){if(R.parentNode.attributes.nodeType=="gx_baselayercontainer"){Ext.getCmp("tbRemoveButton").disable()}else{Ext.getCmp("tbRemoveButton").enable()}Ext.getCmp("tbMetadataButton").enable();Ext.getCmp("btnZoomToExtent").enable()}else{Ext.getCmp("tbRemoveButton").disable();Ext.getCmp("tbMetadataButton").disable();Ext.getCmp("btnZoomToExtent").disable()}};var F=function(){P=new GeoExt.data.PrintProvider({method:"GET",url:GeoNetwork.map.printCapabilities,autoLoad:true});N=new GeoExt.data.PrintPage({printProvider:P});A=new OpenLayers.Layer.Vector(OpenLayers.i18n("printLayer"),{visibility:false});A.addFeatures(N.feature);z.addLayer(A);z.events.register("moveend",z,function(){N.fit(this,{mode:"screen"})});h=new Ext.form.FormPanel({title:OpenLayers.i18n("mf.print.print"),id:"printPanel",bodyStyle:"padding:5px",labelAlign:"top",defaults:{anchor:"100%"},items:[{xtype:"textarea",name:"comment",value:"",fieldLabel:OpenLayers.i18n("mf.print.comment"),plugins:new GeoExt.plugins.PrintPageField({printPage:N})},{xtype:"combo",store:P.layouts,displayField:"name",fieldLabel:OpenLayers.i18n("layout"),typeAhead:true,mode:"local",triggerAction:"all",plugins:new GeoExt.plugins.PrintProviderField({printProvider:P})},{xtype:"combo",store:P.dpis,displayField:"name",fieldLabel:OpenLayers.i18n("mf.print.dpi"),tpl:'<tpl for="."><div class="x-combo-list-item">{name} dpi</div></tpl>',typeAhead:true,mode:"local",triggerAction:"all",plugins:new GeoExt.plugins.PrintProviderField({printProvider:P}),setValue:function(R){R=parseInt(R,10)+" dpi";Ext.form.ComboBox.prototype.setValue.apply(this,arguments)}},{xtype:"combo",store:P.scales,displayField:"name",fieldLabel:OpenLayers.i18n("mf.print.scale"),typeAhead:true,mode:"local",triggerAction:"all",plugins:new GeoExt.plugins.PrintPageField({printPage:N})},{xtype:"textfield",name:"rotation",fieldLabel:OpenLayers.i18n("mf.print.rotation"),plugins:new GeoExt.plugins.PrintPageField({printPage:N})}],buttons:[{text:OpenLayers.i18n("mf.print.generatingPDF"),handler:function(){P.print(Ext.getCmp("mappanel"),N)}}],listeners:{beforeexpand:function(){this.setVisibility(true)},beforecollapse:function(){this.setVisibility(false)},scope:A}})};var d=function(){u=[];var S=new GeoExt.Action({handler:function(){GeoNetwork.WindowManager.showWindow("addwms")},iconCls:"addLayer",tooltip:"Add layer"});u.push(S);S=new GeoExt.Action({id:"tbRemoveButton",handler:function(){Q(q)},iconCls:"deleteLayer",tooltip:"Remove layer"});u.push(S);u.push("-");S=new GeoExt.Action({id:"tbMetadataButton",handler:function(){n(q)},iconCls:"wmsInfo",tooltip:"WMS Information"});u.push(S);k=[];S=new GeoExt.Action({control:new OpenLayers.Control.ZoomToMaxExtent(),map:z,iconCls:"zoomfull"});k.push(S);k.push("-");S=new GeoExt.Action({iconCls:"zoomlayer",id:"btnZoomToExtent",handler:function(){var Y=q;var W;if(Y){W=Y.attributes.layer;if(W){if(W.llbbox){var Z=z.getProjectionObject();var V=new OpenLayers.Projection("WGS84");var T=new OpenLayers.LonLat(W.llbbox[0],W.llbbox[1]).transform(V,Z);var U=new OpenLayers.LonLat(W.llbbox[2],W.llbbox[3]).transform(V,Z);var X=new OpenLayers.Bounds();X.left=T.lon;X.right=U.lon;X.top=U.lat;X.bottom=T.lat;z.zoomToExtent(X)}else{z.zoomToMaxExtent()}}else{Ext.MessageBox.alert(OpenLayers.i18n("zoomlayer.selectLayerTitle"),OpenLayers.i18n("zoomlayer.selectLayerText"))}}else{Ext.MessageBox.alert(OpenLayers.i18n("zoomlayer.selectLayerTitle"),OpenLayers.i18n("zoomlayer.selectLayerText"))}}});k.push(S);k.push("-");S=new GeoExt.Action({control:new OpenLayers.Control.ZoomBox(),map:z,toggleGroup:"move",allowDepress:false,iconCls:"zoomin"});k.push(S);S=new GeoExt.Action({control:new OpenLayers.Control.ZoomBox({displayClass:"ZoomOut",out:true}),toggleGroup:"move",allowDepress:false,map:z,iconCls:"zoomout"});k.push(S);S=new GeoExt.Action({control:new OpenLayers.Control.DragPan({isDefault:true}),toggleGroup:"move",allowDepress:false,pressed:true,map:z,iconCls:"pan"});k.push(S);k.push("-");j=new OpenLayers.Control.WMSGetFeatureInfo({drillDown:true,infoFormat:"application/vnd.ogc.gml"});var R=function(X){var U=-1;for(var W=0,T=z.layers.length;W<T;W++){var V=z.layers[W];if(V!=X){U=Math.max(z.getLayerIndex(z.layers[W]),U)}}if(z.getLayerIndex(X)<U){z.setLayerIndex(X,U+1)}};C=new OpenLayers.Layer.Vector("Feature info",{displayInLayerSwitcher:false,styleMap:new OpenLayers.StyleMap({externalGraphic:OpenLayers.Util.getImagesLocation()+"marker.png",pointRadius:12})});j.events.on({getfeatureinfo:function(U){var V=z.getLonLatFromViewPortPx(U.xy);var T=new OpenLayers.Geometry.Point(V.lon,V.lat);C.destroyFeatures();C.addFeatures(new OpenLayers.Feature.Vector(T));R(C);GeoNetwork.WindowManager.showWindow("featureinfo");GeoNetwork.WindowManager.getWindow("featureinfo").setMap(z);GeoNetwork.WindowManager.getWindow("featureinfo").setFeatures(U.features)},deactivate:function(){C.destroyFeatures()}});S=new GeoExt.Action({control:j,toggleGroup:"move",allowDepress:false,pressed:false,map:z,iconCls:"query"});k.push(S);k.push("-");ctrl=new OpenLayers.Control.NavigationHistory();z.addControl(ctrl);S=new GeoExt.Action({control:ctrl.previous,disabled:true,map:z,iconCls:"back"});k.push(S);S=new GeoExt.Action({control:ctrl.next,disabled:true,map:z,iconCls:"next"});k.push(S);k.push("-");S=new GeoExt.Action({iconCls:"savewmc",handler:function(){GeoNetwork.WMCManager.saveContext(z)}});k.push(S);S=new GeoExt.Action({iconCls:"loadwmc",handler:function(){GeoNetwork.WindowManager.showWindow("loadwmc")}});k.push(S);k.push("->");k.push({xtype:"gn_projectionselector",projections:GeoNetwork.ProjectionList,fieldLabel:OpenLayers.i18n("projectionTitle"),map:z})};var b=function(){var T=new Ext.Panel({cls:"olControlScaleLine overlay-element overlay-scaleline",border:false});T.on("render",function(){var ab=new OpenLayers.Control.ScaleLine({div:T.body.dom});z.addControl(ab);ab.activate()},this);var R;if(w&&w.length>0){var Y=[];var Z=w;var W=z.baseLayer.units;for(var V=Z.length-1;V>=0;V--){var S=Z[V];Y.push({level:V,resolution:OpenLayers.Util.getResolutionFromScale(S,W),scale:S})}R=new GeoExt.data.ScaleStore({});R.loadData(Y)}else{R=new GeoExt.data.ScaleStore({map:z})}var aa=new Ext.form.ComboBox({emptyText:"Zoom level",tpl:'<tpl for="."><div class="x-combo-list-item">1 : {[parseInt(values.scale)]}</div></tpl>',editable:false,triggerAction:"all",mode:"local",store:R,width:110});aa.on("click",function(ab){ab.stopEvent()});aa.on("mousedown",function(ab){ab.stopEvent()});aa.on("select",function(ad,ab,ac){z.zoomTo(ab.data.level)},this);var U=new Ext.Panel({items:[aa],cls:"overlay-element overlay-scalechooser",border:false});z.events.register("zoomend",this,function(){var ab=R.queryBy(function(ac){return z.getZoom()==ac.data.level});if(ab.length>0){ab=ab.items[0];aa.setValue("1 : "+parseInt(ab.data.scale,10))}else{if(!aa.rendered){return}aa.clearValue()}});var X=new Ext.Panel({cls:"map-overlay",items:[T,U]});X.on("afterlayout",function(){T.body.dom.style.position="relative";T.body.dom.style.display="inline";X.getEl().on("click",function(ab){ab.stopEvent()});X.getEl().on("mousedown",function(ab){ab.stopEvent()})},this);return X};var m=function(T,X){var V=new OpenLayers.StyleMap({"default":new OpenLayers.Style(null,{rules:[new OpenLayers.Rule({symbolizer:{Point:{pointRadius:4,graphicName:"square",fillColor:"white",fillOpacity:1,strokeWidth:1,strokeOpacity:1,strokeColor:"#333333"},Line:{strokeWidth:3,strokeOpacity:1,strokeColor:"#666666",strokeDashstyle:"dash"},Polygon:{strokeWidth:2,strokeOpacity:1,strokeColor:"#666666",fillColor:"white",fillOpacity:0.3}}})]})});var S=function(){if(R){R.destroy()}};var U=function(aa){var ab=aa.measure;var Y=aa.units;W.displaySystem="english";var ad=aa.geometry.CLASS_NAME.indexOf("LineString")>-1?W.getBestLength(aa.geometry):W.getBestArea(aa.geometry);var Z=ad[0];var ac=ad[1];W.displaySystem="metric";var ae=aa.order==2?"<sup>2</sup>":"";return ab.toFixed(2)+" "+Y+ae+"<br>"+Z.toFixed(2)+" "+ac+ae};var R;var W=new OpenLayers.Control.Measure(T,{persist:true,handlerOptions:{layerOptions:{styleMap:V}},eventListeners:{measurepartial:function(Z){S();R=new Ext.ToolTip({html:U(Z),title:X,autoHide:false,closable:true,draggable:false,mouseOffset:[0,0],showDelay:1,listeners:{hide:S}});if(Z.measure>0){var Y=W.handler.lastUp;var aa=Ext.getCmp("mappanel").getPosition();R.targetXY=[aa[0]+Y.x,aa[1]+Y.y];R.show()}},measure:function(Y){S();R=new Ext.ToolTip({target:Ext.getBody(),html:U(Y),title:X,autoHide:false,closable:true,draggable:false,mouseOffset:[0,0],showDelay:1,listeners:{hide:function(){W.cancel();S()}}})},deactivate:S,scope:this}});return W};var H=function(){var R=new OpenLayers.Format.JSON().write([{nodeType:"gx_baselayercontainer"},{nodeType:"gx_overlaylayercontainer",expanded:true,loader:{baseAttrs:{radioGroup:"foo",slider:"layeropacityslider",uiProvider:"layernodeui"}}}],true);var S=Ext.extend(GeoExt.tree.LayerNodeUI,new GeoExt.tree.TreeNodeUIEventMixin());s=new Ext.tree.TreePanel({title:OpenLayers.i18n("layerTree"),id:"toctree",enableDD:true,loader:new Ext.tree.TreeLoader({applyLoader:false,uiProviders:{layernodeui:S}}),plugins:[new GeoExt.plugins.FoldableLegendPlugin({}),new GeoExt.plugins.ShowOnlyVisibleLayersPlugin({})],root:{nodeType:"async",children:Ext.decode(R)},listeners:{contextmenu:function(T,U){if((T.attributes.nodeType!="gx_overlaylayercontainer")&&(T.attributes.nodeType!="gx_baselayercontainer")){T.select();var V=T.getOwnerTree().contextMenu;if(T.parentNode.attributes.nodeType=="gx_baselayercontainer"){V.items.get("removeMenu").disable()}else{V.items.get("removeMenu").enable()}V.items.get("addMenu").hide();V.contextNode=T;V.showAt(U.getXY())}else{if(T.attributes.nodeType=="gx_overlaylayercontainer"){T.select();V=T.getOwnerTree().contextMenu;V.items.get("addMenu").show();V.items.get("removeMenu").hide();V.items.get("metadataMenu").hide();V.contextNode=T;V.showAt(U.getXY())}}},scope:this},contextMenu:new Ext.menu.Menu({items:[{text:"Add layer",id:"addMenu",handler:function(){GeoNetwork.WindowManager.showWindow("addwms")}},{text:OpenLayers.i18n("removeButtonText"),id:"removeMenu",handler:E},{text:"WMS information",id:"metadataMenu",handler:c}]}),tbar:u,rootVisible:false,lines:false,border:false,region:"center"})};var G=function(){O=new GeoExt.LegendPanel({defaults:{labelCls:"mylabel",style:"padding:5px"},title:"Legend",height:200,autoScroll:true,split:true,collapsible:true,collapsed:true,border:false,region:"south"})};var g=function(){d();H();G();F();var S=b();var R=new Ext.Panel({id:"mapAccordionSidePanel",region:"center",border:false,layout:"accordion",deferredRender:false,items:[s,h]});I=new Ext.Panel({layout:"border",border:false,items:[{region:"east",xtype:"panel",id:"mapViewportEastPanel",collapsible:true,collapsed:true,collapseMode:"mini",split:true,border:false,width:170,minSize:170,maxSize:300,layout:"border",items:[R,O]},{region:"center",layout:"fit",frame:false,border:false,margins:"0 0 0 0",items:[{id:"mappanel",xtype:"gx_mappanel",map:z,tbar:k,border:false,center:[155000,463000],zoom:2,items:[S]}]}]});Ext.getCmp("toctree").on({click:function(T){if(T.ui.radio){T.ui.radio.checked=true;T.ui.fireEvent("radiochange",T)}p(T)},scope:this});Ext.getCmp("toctree").on("nodedragover",function(T){if((T.dropNode.parentNode.attributes.nodeType=="gx_baselayercontainer")||(T.target.attributes.nodeType=="gx_baselayercontainer")||(T.target.parentNode.attributes.nodeType=="gx_baselayercontainer")||(T.target.parentNode==T.tree.root)){T.cancel=true}});p(q)};var M=function(Y){y.hide();var S=new OpenLayers.Format.WMSCapabilities();var X=S.read(Y.responseXML||Y.responseText);if(X.capability){var W=X.service.accessContraints;if((W)&&(W.toLowerCase()!="none")&&(W!="-")){var T=new GeoNetwork.DisclaimerWindow({disclaimer:W});T.show();T=null}if(z){for(var aa=0,ac=J.length;aa<ac;aa++){var U=J[aa][0];var R=J[aa][1];var ab=J[aa][2];var V=J[aa][3];var Z=new OpenLayers.Layer.WMS(U,R,{layers:ab,format:"image/png",transparent:"TRUE",version:X.version,language:GeoNetwork.OGCUtil.getLanguage()},{queryable:true,singleTile:true,ratio:1,buffer:0,transitionEffect:"resize",metadata_id:V});if(!GeoNetwork.OGCUtil.layerExistsInMap(Z,z)){Z.events.on({loadstart:function(){this.isLoading=true}});Z.events.on({loadend:function(){this.isLoading=false}});var ad=a(X,X.capability.layers,Z);if(ad){Z.queryable=ad.queryable;Z.name=ad.title||Z.name;Z.llbbox=ad.llbbox;Z.styles=ad.styles;Z.dimensions=ad.dimensions}z.addLayer(Z)}}}}};var e=function(R){y.hide();Ext.MessageBox.alert(OpenLayers.i18n("loadLayer.error.title"),OpenLayers.i18n("loadLayer.error.message"))};var a=function(R,Y,U){var Z=null;for(var S=0,W=Y.length;S<W;++S){var T=Y[S];try{var V=T.name.split(",");if(V.indexOf(U.params.LAYERS)!=-1){Z=T;break}}catch(X){}if(typeof(T.childLayers)!="undefined"){Z=a(R,T.childLayers,U);if(Z!==null){break}}}return Z};return{init:function(U,S,R){r(S,R);for(var T=0;T<U.length;T++){L(U[T].clone())}GeoExt.MapPanel.guess=function(){return Ext.getCmp("mappanel")};g();f();GeoNetwork.WindowManager.registerWindow("addwms",GeoNetwork.AddWmsLayerWindow,{map:z,id:"addwms"});GeoNetwork.WindowManager.registerWindow("wmsinfo",GeoNetwork.WmsLayerMetadataWindow,{map:z,id:"wmsinfo"});GeoNetwork.WindowManager.registerWindow("loadwmc",GeoNetwork.LoadWmcWindow,{map:z,id:"loadwmc"});GeoNetwork.WindowManager.registerWindow("featureinfo",GeoNetwork.FeatureInfoWindow,{map:z,id:"featureinfo",control:j});z.addLayer(C)},addWMSLayer:function(U){if(U.length===0){return}var S=U[0][1];if(U[0][2]==""){GeoNetwork.WindowManager.showWindow("addwms");var R=Ext.getCmp(GeoNetwork.WindowManager.getWindow("addwms").browserPanel.id);R.setURL(S);return}y=new Ext.LoadMask(z.div,{msg:OpenLayers.Lang.translate("loadLayer.loadingMessage")});y.show();J=U;var X={service:"WMS",request:"GetCapabilities",version:"1.1.1"};var W=OpenLayers.Util.getParameterString(X);var V=(S.indexOf("?")>-1)?"&":"?";S+=V+W;var T=OpenLayers.Request.GET({url:S,success:M,failure:e,timeout:10000})},getViewport:function(){return I},refreshViewport:function(){Ext.get("west_panel").setWidth(westPanelWidth);I.doLayout()},getMap:function(){return z},getPrintPanel:function(){if(h===null){F()}return h}}};OpenLayers.DOTS_PER_INCH=90.71;OpenLayers.ImgPath="../js/OpenLayers/img/";OpenLayers.IMAGE_RELOAD_ATTEMPTS=3;OpenLayers.Util.onImageLoadErrorColor="transparent";OpenLayers.Lang.setCode(GeoNetwork.defaultLocale);OpenLayers.Util.onImageLoadError=function(){this._attempts=(this._attempts)?(this._attempts+1):1;if(this._attempts<=OpenLayers.IMAGE_RELOAD_ATTEMPTS){this.src=this.src}else{this.style.backgroundColor=OpenLayers.Util.onImageLoadErrorColor;this.style.display="none"}};Proj4js.defs["EPSG:2154"]="+proj=lcc +lat_1=49 +lat_2=44 +lat_0=46.5 +lon_0=3 +x_0=700000 +y_0=6600000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs";GeoNetwork.map.printCapabilities="../../pdf";GeoNetwork.map.PROJECTION="EPSG:4326";GeoNetwork.map.EXTENT=new OpenLayers.Bounds(-180,-90,180,90);GeoNetwork.map.BACKGROUND_LAYERS=[new OpenLayers.Layer.WMS("Background layer","http://localhost:8080/geoserver/wms",{layers:"ige:Cntry00",format:"image/jpeg"},{isBaseLayer:true})];GeoNetwork.map.MAP_OPTIONS={projection:GeoNetwork.map.PROJECTION,maxExtent:GeoNetwork.map.EXTENT,restrictedExtent:GeoNetwork.map.EXTENT,controls:[]};GeoNetwork.map.MAIN_MAP_OPTIONS={projection:GeoNetwork.map.PROJECTION,maxExtent:GeoNetwork.map.EXTENT,restrictedExtent:GeoNetwork.map.EXTENT,controls:[]};